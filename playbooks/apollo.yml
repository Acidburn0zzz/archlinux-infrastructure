---

- name: setup apollo
  hosts: apollo
  remote_user: root
  roles:
    - { role: common, tags: ['common'] }
    - { role: tools, tags: ['tools'] }
    - { role: sshd, tags: ['sshd'] }
    - { role: root_ssh, tags: ['root_ssh'] }
    - { role: borg-client, backup_host: "borg@vostok.archlinux.org", backup_dir: "/backup/apollo", postgres_backup_dir: "/var/lib/postgres/backup", tags: ["borg"] }
    - { role: nginx, letsencrypt_validation_dir: "/var/lib/letsencrypt", tags: ["nginx"] }
    - { role: planet, planet_domain: "planet.archlinux.org", planet_dir: "/srv/http/planet", tags: ["planet"] }
    - { role: postfix, postfix_server: false, tags: ["mail"] }
    - { role: opendkim, dkim_selector: apollo, tags: ['mail'] }
    - { role: dovecot, tags: ['mail', "dovecot"] }
    - { role: postfwd, tags: ['mail', "postfwd"] }
